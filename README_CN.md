TL4ICF_DEMO 是一个项目，旨在复现本[论文](https://ieeexplore.ieee.org/document/8932676?arnumber=8932676)中的迁移学习示例，以及为未来的DCI项目中的人工智能预测搭好框架。

- [介绍](#introduction)
- [生成数据](#生成数据)
- [训练模型](#训练模型)
- [结果](#result)


# 简介 
正如文章所说

> 复杂物理系统的计算机模拟通常采用不同保真度的模型。计算成本低廉的低保真模型可用于探索广阔的设计空间，以获得最佳设置，而昂贵的高保真模型则可用于设计空间的有趣区域，以计算对计划实验的预测。高保真模拟通常比近似模型更准确、更可靠，但运行模拟的费用往往使其无法用于大参数扫描。利用迁移学习可以创建模拟高保真模拟的模型，并降低计算成本。

换句话说，从这个角度来看，**转移学习**更像是**预训练和微调**。为了展现迁移学习（即文章中的分层迁移学习）的实用性，我们考虑一个非线性函数：
$$f(x)=xe^{ax}$$
为了使用神经网络学习这个函数，很容易生成数据，然后建立一个简单的网络。然而，当数据集不够大时，这种方法可能行不通。

在接下来的章节中，我们将介绍在低保真数据库中预先训练网络的方法，这种方法可以生成基于低保真数据的模型，然后在稀疏且高保真的数据库中对其进行微调。我们还将比较不同模型的效果。

# 生成数据
由于我们想从低保真数据库中学习函数，因此我们考虑对其进行泰勒展开：
$$f(x)=xe^{ax}=x+ax^2+\cdots$$

在“DATA”文件夹下有三个代码，分别用于生成 $f_{low}(x)=x$、 $f_{high}(x)=x+ax^2$、 $f_{exp}(x)=xe^{ax}$的数据库。数据库的大小取决于您的模型和参数空间，我们建议使用以下参数组合：
|模型名称|描述|学习路径|数据库大小|
|---|---|---|---|
|Exp|实验数据直接训练|$xe^{ax}$|100|
|Low2Exp|低保真数据到实验数据|$x\Rightarrow xe^{ax}$|100 $\Rightarrow$ 25|
|High2Exp|高保真数据到实验数据|$x+ax^2\Rightarrow xe^{ax}$|100 $\Rightarrow$ 25|
|Low2High2Exp|低保真数据到高保真数据到实验数据|$x\Rightarrow x+ax^2\Rightarrow xe^{ax}$|100 $\Rightarrow$ 50 $\Rightarrow$ 25|

参数空间为
$$a\in[0,1],x\in[-1,1]$$

我们还提供了一个名为 “plot ”的简单代码，用于可视化数据库的数据分布。
> 需要注意的是，每个型号的数据库都不尽相同，不仅在规模上，在具体分布上也不尽相同。抽样方法为随机抽样。

# 训练模型
以下文件夹
- exp_model
- low2exp_model
- high2exp_model
- low2high2exp_model
包含相应的代码。以 low2high2exp_model 为例：
- train_low.py 用于从低模型度数据库中训练预训练模型；
- train_low_high_exp.py用于从高保真和真实数据库中微调模型；
- low_high_exp_logs_{time}可通过 tensorboard 打开，以查看误差曲线（对数纵轴）；
- {model}.pth 是模型文件；
- plot_reg_low_high_exp.py 用于绘制回归图，并保存到 “fig”文件夹中。

> 请注意，在 low2exp_model 和 low2high2exp_model 中，有两个名为 train_low.py 的相同代码。为了控制变量，每个代码都会在两个文件夹中同时生成名为 low_model.pth 的相同模型文件。

# 结果
这八幅图将保存在 fig 文件夹中，并有一个名为 plot_table.py 的代码将它们合并。

现有模型文件中每个模型的方差：
|模型名称|方差|训练循环数|
|---|---|---|
|Exp|5.23e-4|2000|
|Low2Exp|3.86e-3|1000&5000|
|High2Exp|4.01e-3|1000&4000|
|Low2High2Exp|1.45e-3|1000&3000&3000|


这很符合直觉的，因为第四个模型包含的信息是四个模型中第二多的。我们还可以预测，如果我们只用 25 条数据来训练 exp_model，exp_model 无法与 Low2High2Exp_model 竞争。实际上，方差是 1e-2。
